<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisor DPR System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #1e40af;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #1e3a8a;
        }
        .btn-secondary {
            background-color: #64748b;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #475569;
        }
        .input-field {
            transition: all 0.3s ease;
            border: 1px solid #cbd5e1;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .logo-text {
            background: linear-gradient(45deg, #1e40af, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="app" class="max-w-4xl mx-auto px-4 py-6">
        <!-- Login Screen -->
        <div id="login-screen" class="fade-in">
            <div class="flex justify-center mb-8">
                <h1 class="text-3xl font-bold logo-text">DPR System</h1>
            </div>
            <div class="card bg-white rounded-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Supervisor Login</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <select id="username" class="input-field w-full p-2 rounded-md">
                        <option value="" disabled selected>Select your name</option>
                        <option value="MAHENDRA KUMAR">MAHENDRA KUMAR</option>
                        <option value="PINTU SAH">PINTU SAH</option>
                        <option value="HARKIRAT SINGH">HARKIRAT SINGH</option>
                        <option value="SUNIL CHAUHAN">SUNIL CHAUHAN</option>
                        <option value="NSUP1">NSUP1</option>
                        <option value="NSUP2">NSUP2</option>
                        <option value="NSUP3">NSUP3</option>
                        <option value="NSUP4">NSUP4</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" class="input-field w-full p-2 rounded-md" placeholder="First 4 letters + last 2 digits of mobile">
                </div>
                <div class="flex justify-between items-center">
                    <button id="login-btn" class="btn-primary text-white px-4 py-2 rounded-md">Login</button>
                    <button id="register-toggle" class="text-sm text-blue-600 hover:underline">New user? Register</button>
                </div>
            </div>
            <div id="login-error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
                Invalid username or password. Please try again.
            </div>
        </div>

        <!-- Registration Screen -->
        <div id="register-screen" class="hidden fade-in">
            <div class="flex justify-center mb-8">
                <h1 class="text-3xl font-bold logo-text">DPR System</h1>
            </div>
            <div class="card bg-white rounded-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Supervisor Registration</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="reg-name" class="input-field w-full p-2 rounded-md" placeholder="Enter your full name">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
                    <input type="text" id="reg-mobile" class="input-field w-full p-2 rounded-md" placeholder="Enter your mobile number">
                </div>
                <div class="flex justify-between items-center">
                    <button id="register-btn" class="btn-primary text-white px-4 py-2 rounded-md">Register</button>
                    <button id="login-toggle" class="text-sm text-blue-600 hover:underline">Already registered? Login</button>
                </div>
            </div>
            <div id="register-info" class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4">
                Registration successful! Your password is <span id="generated-password" class="font-bold"></span>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="hidden fade-in">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-bold logo-text">DPR System</h1>
                <div class="flex items-center">
                    <span id="user-display" class="mr-4 text-gray-700"></span>
                    <button id="logout-btn" class="btn-secondary text-white px-3 py-1 text-sm rounded-md">Logout</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="mb-6">
                <div class="flex border-b border-gray-200">
                    <button id="tab-attendance" class="tab-btn py-2 px-4 border-b-2 border-blue-500 text-blue-600 font-medium">Attendance</button>
                    <button id="tab-dpr" class="tab-btn py-2 px-4 border-b-2 border-transparent text-gray-500 font-medium">DPR</button>
                    <button id="tab-summary" class="tab-btn py-2 px-4 border-b-2 border-transparent text-gray-500 font-medium">Summary</button>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div id="attendance-content" class="tab-content fade-in">
                <div class="card bg-white rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Start of Shift - Attendance</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor</label>
                        <input type="text" id="attendance-supervisor" class="input-field w-full p-2 rounded-md bg-gray-100" readonly>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="attendance-date" class="input-field w-full p-2 rounded-md">
                    </div>
                    <div class="mb-4" id="manpower-input-container">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Add Manpower</label>
                        <div class="flex">
                            <input type="text" id="manpower-name" class="input-field w-full p-2 rounded-l-md" placeholder="Enter worker name">
                            <button id="add-manpower-btn" class="btn-primary text-white px-4 py-2 rounded-r-md">Add</button>
                        </div>
                    </div>
                    <div id="manpower-list" class="mb-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">Manpower List:</h3>
                        <ul id="manpower-items" class="bg-gray-50 rounded-md p-2 min-h-[100px] border border-gray-200">
                            <!-- Manpower items will be added here -->
                        </ul>
                    </div>
                    <button id="submit-attendance-btn" class="btn-primary text-white px-4 py-2 rounded-md w-full">Submit Attendance</button>
                </div>
            </div>

            <!-- DPR Tab -->
            <div id="dpr-content" class="tab-content hidden fade-in">
                <div class="card bg-white rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">End of Shift - Daily Progress Report</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor</label>
                        <input type="text" id="dpr-supervisor" class="input-field w-full p-2 rounded-md bg-gray-100" readonly>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="dpr-date" class="input-field w-full p-2 rounded-md bg-gray-100" readonly>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Activity Type</label>
                        <select id="activity-type" class="input-field w-full p-2 rounded-md">
                            <option value="erection">Erection</option>
                            <option value="dismantling">Dismantling</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Length (m)</label>
                            <input type="number" id="length" class="input-field w-full p-2 rounded-md" step="0.01">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Width (m)</label>
                            <input type="number" id="width" class="input-field w-full p-2 rounded-md" step="0.01">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Height (m)</label>
                            <input type="number" id="height" class="input-field w-full p-2 rounded-md" step="0.01">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                            <input type="number" id="quantity" class="input-field w-full p-2 rounded-md" value="1">
                        </div>
                    </div>
                    <div class="mb-6">
                        <button id="add-work-btn" class="btn-primary text-white px-4 py-2 rounded-md w-full">Add Work Entry</button>
                    </div>
                    <div id="work-entries" class="mb-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">Work Entries:</h3>
                        <div class="bg-gray-50 rounded-md p-2 min-h-[100px] border border-gray-200">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-300">
                                        <th class="py-2 text-left">Type</th>
                                        <th class="py-2 text-left">Dimensions</th>
                                        <th class="py-2 text-right">Volume</th>
                                    </tr>
                                </thead>
                                <tbody id="work-items">
                                    <!-- Work items will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <button id="proceed-to-summary-btn" class="btn-primary text-white px-4 py-2 rounded-md w-full">Proceed to Summary</button>
                </div>
            </div>

            <!-- Summary Tab -->
            <div id="summary-content" class="tab-content hidden fade-in">
                <div class="card bg-white rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Daily Progress Summary</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor</label>
                        <input type="text" id="summary-supervisor" class="input-field w-full p-2 rounded-md bg-gray-100" readonly>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="summary-date" class="input-field w-full p-2 rounded-md bg-gray-100" readonly>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-md font-medium text-gray-800 mb-2">Manpower Attendance</h3>
                        <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
                            <div id="manpower-summary" class="mb-3">
                                <!-- Manpower summary will be added here -->
                            </div>
                            <div class="text-sm text-gray-700">
                                <span class="font-medium">Total Manpower:</span> <span id="total-manpower">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-md font-medium text-gray-800 mb-2">Overtime Hours</h3>
                        <div id="overtime-inputs" class="bg-gray-50 rounded-md p-3 border border-gray-200">
                            <!-- Overtime inputs will be added here -->
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-md font-medium text-gray-800 mb-2">Work Summary</h3>
                        <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
                            <div class="grid grid-cols-2 gap-2 mb-2">
                                <div class="text-sm text-gray-700">
                                    <span class="font-medium">Total Erection Volume:</span>
                                    <span id="total-erection">0</span> m³
                                </div>
                                <div class="text-sm text-gray-700">
                                    <span class="font-medium">Total Dismantling Volume:</span>
                                    <span id="total-dismantling">0</span> m³
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="text-sm text-gray-700">
                                    <span class="font-medium">Total Manhours:</span>
                                    <span id="total-manhours">0</span> hrs
                                </div>
                                <div class="text-sm text-gray-700">
                                    <span class="font-medium">Productivity:</span>
                                    <span id="productivity">0</span> m³/hr
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6" id="productivity-feedback">
                        <!-- Productivity feedback will be added here -->
                    </div>
                    
                    <div class="flex flex-col space-y-3">
                        <button id="submit-dpr-btn" class="btn-primary text-white px-4 py-2 rounded-md">Submit Final Report</button>
                        <button id="share-whatsapp-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                            Share via WhatsApp
                        </button>
                    </div>
                </div>
                
                <div id="success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
                    Report submitted successfully! Data has been saved to Google Sheets.
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // App state
            const state = {
                currentUser: null,
                users: [
                    { name: 'MAHENDRA KUMAR', password: 'MAHE90' },
                    { name: 'PINTU SAH', password: 'PINT90' },
                    { name: 'HARKIRAT SINGH', password: 'HARK90' },
                    { name: 'SUNIL CHAUHAN', password: 'SUNI90' },
                    { name: 'NSUP1', password: 'NSUP90' },
                    { name: 'NSUP2', password: 'NSUP90' },
                    { name: 'NSUP3', password: 'NSUP90' },
                    { name: 'NSUP4', password: 'NSUP90' }
                ],
                attendance: {
                    date: new Date().toISOString().split('T')[0],
                    manpower: []
                },
                dpr: {
                    workEntries: [],
                    totalErection: 0,
                    totalDismantling: 0
                },
                overtime: {},
                attendanceSubmitted: false,
                dprSubmitted: false
            };

            // DOM Elements
            const elements = {
                // Screens
                loginScreen: document.getElementById('login-screen'),
                registerScreen: document.getElementById('register-screen'),
                dashboard: document.getElementById('dashboard'),
                
                // Login
                username: document.getElementById('username'),
                password: document.getElementById('password'),
                loginBtn: document.getElementById('login-btn'),
                loginError: document.getElementById('login-error'),
                registerToggle: document.getElementById('register-toggle'),
                
                // Register
                regName: document.getElementById('reg-name'),
                regMobile: document.getElementById('reg-mobile'),
                registerBtn: document.getElementById('register-btn'),
                loginToggle: document.getElementById('login-toggle'),
                registerInfo: document.getElementById('register-info'),
                generatedPassword: document.getElementById('generated-password'),
                
                // Dashboard
                userDisplay: document.getElementById('user-display'),
                logoutBtn: document.getElementById('logout-btn'),
                
                // Tabs
                tabAttendance: document.getElementById('tab-attendance'),
                tabDpr: document.getElementById('tab-dpr'),
                tabSummary: document.getElementById('tab-summary'),
                attendanceContent: document.getElementById('attendance-content'),
                dprContent: document.getElementById('dpr-content'),
                summaryContent: document.getElementById('summary-content'),
                
                // Attendance
                attendanceSupervisor: document.getElementById('attendance-supervisor'),
                attendanceDate: document.getElementById('attendance-date'),
                manpowerName: document.getElementById('manpower-name'),
                addManpowerBtn: document.getElementById('add-manpower-btn'),
                manpowerItems: document.getElementById('manpower-items'),
                submitAttendanceBtn: document.getElementById('submit-attendance-btn'),
                
                // DPR
                dprSupervisor: document.getElementById('dpr-supervisor'),
                dprDate: document.getElementById('dpr-date'),
                activityType: document.getElementById('activity-type'),
                length: document.getElementById('length'),
                width: document.getElementById('width'),
                height: document.getElementById('height'),
                quantity: document.getElementById('quantity'),
                addWorkBtn: document.getElementById('add-work-btn'),
                workItems: document.getElementById('work-items'),
                proceedToSummaryBtn: document.getElementById('proceed-to-summary-btn'),
                
                // Summary
                summarySupervisor: document.getElementById('summary-supervisor'),
                summaryDate: document.getElementById('summary-date'),
                manpowerSummary: document.getElementById('manpower-summary'),
                totalManpower: document.getElementById('total-manpower'),
                overtimeInputs: document.getElementById('overtime-inputs'),
                totalErection: document.getElementById('total-erection'),
                totalDismantling: document.getElementById('total-dismantling'),
                totalManhours: document.getElementById('total-manhours'),
                productivity: document.getElementById('productivity'),
                productivityFeedback: document.getElementById('productivity-feedback'),
                submitDprBtn: document.getElementById('submit-dpr-btn'),
                shareWhatsappBtn: document.getElementById('share-whatsapp-btn'),
                successMessage: document.getElementById('success-message')
            };

            // Set current date as default
            elements.attendanceDate.value = state.attendance.date;

            // Event Listeners
            // Login & Registration
            elements.loginBtn.addEventListener('click', handleLogin);
            elements.registerToggle.addEventListener('click', () => {
                elements.loginScreen.classList.add('hidden');
                elements.registerScreen.classList.remove('hidden');
            });
            elements.loginToggle.addEventListener('click', () => {
                elements.registerScreen.classList.add('hidden');
                elements.loginScreen.classList.remove('hidden');
            });
            elements.registerBtn.addEventListener('click', handleRegister);
            elements.logoutBtn.addEventListener('click', handleLogout);

            // Tab Navigation
            elements.tabAttendance.addEventListener('click', () => switchTab('attendance'));
            elements.tabDpr.addEventListener('click', () => switchTab('dpr'));
            elements.tabSummary.addEventListener('click', () => switchTab('summary'));

            // Attendance
            elements.addManpowerBtn.addEventListener('click', addManpower);
            elements.submitAttendanceBtn.addEventListener('click', submitAttendance);

            // DPR
            elements.addWorkBtn.addEventListener('click', addWorkEntry);
            elements.proceedToSummaryBtn.addEventListener('click', proceedToSummary);

            // Summary
            elements.submitDprBtn.addEventListener('click', submitDpr);
            elements.shareWhatsappBtn.addEventListener('click', shareViaWhatsapp);

            // Functions
            function handleLogin() {
                const username = elements.username.value;
                const password = elements.password.value;
                
                const user = state.users.find(u => u.name === username && u.password === password);
                
                if (user) {
                    state.currentUser = user.name;
                    elements.loginError.classList.add('hidden');
                    elements.loginScreen.classList.add('hidden');
                    elements.dashboard.classList.remove('hidden');
                    elements.userDisplay.textContent = state.currentUser;
                    
                    // Set supervisor name in all tabs
                    elements.attendanceSupervisor.value = state.currentUser;
                    elements.dprSupervisor.value = state.currentUser;
                    elements.summarySupervisor.value = state.currentUser;
                    
                    // Check if attendance was already submitted
                    if (state.attendanceSubmitted) {
                        switchTab('dpr');
                    } else {
                        switchTab('attendance');
                    }
                } else {
                    elements.loginError.classList.remove('hidden');
                }
            }

            function handleRegister() {
                const name = elements.regName.value.trim();
                const mobile = elements.regMobile.value.trim();
                
                if (name && mobile && mobile.length >= 2) {
                    // Generate password (first 4 letters of name + last 2 digits of mobile)
                    const namePrefix = name.substring(0, 4).toUpperCase();
                    const mobilePostfix = mobile.slice(-2);
                    const password = namePrefix + mobilePostfix;
                    
                    // Add new user
                    state.users.push({ name, password });
                    
                    // Show success message
                    elements.generatedPassword.textContent = password;
                    elements.registerInfo.classList.remove('hidden');
                    
                    // Clear form
                    elements.regName.value = '';
                    elements.regMobile.value = '';
                    
                    // Auto switch to login after 3 seconds
                    setTimeout(() => {
                        elements.registerScreen.classList.add('hidden');
                        elements.loginScreen.classList.remove('hidden');
                        elements.registerInfo.classList.add('hidden');
                    }, 3000);
                }
            }

            function handleLogout() {
                elements.dashboard.classList.add('hidden');
                elements.loginScreen.classList.remove('hidden');
                elements.username.value = '';
                elements.password.value = '';
                resetState();
            }

            function resetState() {
                state.currentUser = null;
                state.attendance = {
                    date: new Date().toISOString().split('T')[0],
                    manpower: []
                };
                state.dpr = {
                    workEntries: [],
                    totalErection: 0,
                    totalDismantling: 0
                };
                state.overtime = {};
                state.attendanceSubmitted = false;
                state.dprSubmitted = false;
                
                // Reset UI elements
                elements.manpowerItems.innerHTML = '';
                elements.workItems.innerHTML = '';
                elements.attendanceDate.value = state.attendance.date;
                elements.manpowerName.value = '';
                elements.length.value = '';
                elements.width.value = '';
                elements.height.value = '';
                elements.quantity.value = '1';
                elements.successMessage.classList.add('hidden');
            }

            function switchTab(tab) {
                // Hide all tab contents
                elements.attendanceContent.classList.add('hidden');
                elements.dprContent.classList.add('hidden');
                elements.summaryContent.classList.add('hidden');
                
                // Reset tab styles
                elements.tabAttendance.classList.remove('border-blue-500', 'text-blue-600');
                elements.tabAttendance.classList.add('border-transparent', 'text-gray-500');
                elements.tabDpr.classList.remove('border-blue-500', 'text-blue-600');
                elements.tabDpr.classList.add('border-transparent', 'text-gray-500');
                elements.tabSummary.classList.remove('border-blue-500', 'text-blue-600');
                elements.tabSummary.classList.add('border-transparent', 'text-gray-500');
                
                // Show selected tab
                if (tab === 'attendance') {
                    elements.attendanceContent.classList.remove('hidden');
                    elements.tabAttendance.classList.remove('border-transparent', 'text-gray-500');
                    elements.tabAttendance.classList.add('border-blue-500', 'text-blue-600');
                } else if (tab === 'dpr') {
                    if (!state.attendanceSubmitted) {
                        alert('Please submit attendance first!');
                        switchTab('attendance');
                        return;
                    }
                    elements.dprContent.classList.remove('hidden');
                    elements.tabDpr.classList.remove('border-transparent', 'text-gray-500');
                    elements.tabDpr.classList.add('border-blue-500', 'text-blue-600');
                } else if (tab === 'summary') {
                    if (!state.attendanceSubmitted) {
                        alert('Please submit attendance first!');
                        switchTab('attendance');
                        return;
                    }
                    if (state.dpr.workEntries.length === 0) {
                        alert('Please add at least one work entry!');
                        switchTab('dpr');
                        return;
                    }
                    elements.summaryContent.classList.remove('hidden');
                    elements.tabSummary.classList.remove('border-transparent', 'text-gray-500');
                    elements.tabSummary.classList.add('border-blue-500', 'text-blue-600');
                }
            }

            function addManpower() {
                const name = elements.manpowerName.value.trim();
                if (name) {
                    state.attendance.manpower.push(name);
                    
                    const li = document.createElement('li');
                    li.className = 'py-1 px-2 bg-white rounded mb-1 shadow-sm flex justify-between items-center';
                    li.innerHTML = `
                        <span>${name}</span>
                        <button class="text-red-500 hover:text-red-700" data-index="${state.attendance.manpower.length - 1}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;
                    
                    // Add delete functionality
                    li.querySelector('button').addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        state.attendance.manpower.splice(index, 1);
                        elements.manpowerItems.removeChild(li);
                        // Update indices for remaining items
                        const buttons = elements.manpowerItems.querySelectorAll('button');
                        buttons.forEach((btn, i) => {
                            btn.setAttribute('data-index', i);
                        });
                    });
                    
                    elements.manpowerItems.appendChild(li);
                    elements.manpowerName.value = '';
                }
            }

            function submitAttendance() {
                if (state.attendance.manpower.length === 0) {
                    alert('Please add at least one manpower!');
                    return;
                }
                
                state.attendance.date = elements.attendanceDate.value;
                state.attendanceSubmitted = true;
                
                // Update DPR date to match attendance date
                elements.dprDate.value = state.attendance.date;
                
                // Switch to DPR tab
                switchTab('dpr');
                
                // Disable attendance inputs
                elements.attendanceDate.readOnly = true;
                elements.attendanceDate.classList.add('bg-gray-100');
                elements.manpowerName.disabled = true;
                elements.addManpowerBtn.disabled = true;
                elements.submitAttendanceBtn.disabled = true;
                elements.submitAttendanceBtn.classList.add('opacity-50');
            }

            function addWorkEntry() {
                const length = parseFloat(elements.length.value);
                const width = parseFloat(elements.width.value);
                const height = parseFloat(elements.height.value);
                const quantity = parseInt(elements.quantity.value);
                const activityType = elements.activityType.value;
                
                if (isNaN(length) || isNaN(width) || isNaN(height) || isNaN(quantity)) {
                    alert('Please enter valid dimensions!');
                    return;
                }
                
                let volume = length * width * height * quantity;
                if (activityType === 'dismantling') {
                    volume = volume / 2;
                }
                
                const entry = {
                    type: activityType,
                    length,
                    width,
                    height,
                    quantity,
                    volume
                };
                
                state.dpr.workEntries.push(entry);
                
                // Update totals
                if (activityType === 'erection') {
                    state.dpr.totalErection += volume;
                } else {
                    state.dpr.totalDismantling += volume;
                }
                
                // Add to UI
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-200';
                tr.innerHTML = `
                    <td class="py-2 capitalize">${activityType}</td>
                    <td class="py-2">${length}m × ${width}m × ${height}m × ${quantity}</td>
                    <td class="py-2 text-right">${volume.toFixed(2)} m³</td>
                `;
                elements.workItems.appendChild(tr);
                
                // Clear inputs
                elements.length.value = '';
                elements.width.value = '';
                elements.height.value = '';
                elements.quantity.value = '1';
            }

            function proceedToSummary() {
                if (state.dpr.workEntries.length === 0) {
                    alert('Please add at least one work entry!');
                    return;
                }
                
                // Update summary date
                elements.summaryDate.value = state.attendance.date;
                
                // Generate manpower summary
                elements.manpowerSummary.innerHTML = '';
                state.attendance.manpower.forEach(name => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center mb-2';
                    div.innerHTML = `
                        <span class="text-sm">${name}</span>
                        <span class="text-sm">Present</span>
                    `;
                    elements.manpowerSummary.appendChild(div);
                });
                
                // Update total manpower
                elements.totalManpower.textContent = state.attendance.manpower.length;
                
                // Generate overtime inputs
                elements.overtimeInputs.innerHTML = '';
                state.attendance.manpower.forEach(name => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center mb-2';
                    div.innerHTML = `
                        <span class="text-sm">${name}</span>
                        <input type="number" class="input-field w-20 p-1 text-sm rounded-md" 
                               min="0" max="12" step="0.5" value="0" data-name="${name}">
                    `;
                    elements.overtimeInputs.appendChild(div);
                    
                    // Add event listener to update overtime
                    const input = div.querySelector('input');
                    input.addEventListener('change', function() {
                        const name = this.getAttribute('data-name');
                        const hours = parseFloat(this.value) || 0;
                        state.overtime[name] = hours;
                        updateProductivity();
                    });
                });
                
                // Update work summary
                elements.totalErection.textContent = state.dpr.totalErection.toFixed(2);
                elements.totalDismantling.textContent = state.dpr.totalDismantling.toFixed(2);
                
                // Initialize overtime object
                state.attendance.manpower.forEach(name => {
                    state.overtime[name] = 0;
                });
                
                // Calculate initial productivity
                updateProductivity();
                
                // Switch to summary tab
                switchTab('summary');
            }

            function updateProductivity() {
                // Calculate total manhours
                const regularHours = state.attendance.manpower.length * 8;
                const overtimeHours = Object.values(state.overtime).reduce((sum, hours) => sum + hours, 0);
                const totalManhours = regularHours + overtimeHours;
                
                // Calculate productivity
                const totalVolume = state.dpr.totalErection + state.dpr.totalDismantling;
                const productivity = totalManhours > 0 ? totalVolume / totalManhours : 0;
                
                // Update UI
                elements.totalManhours.textContent = totalManhours.toFixed(1);
                elements.productivity.textContent = productivity.toFixed(2);
                
                // Update productivity feedback
                let feedbackClass, feedbackText;
                if (productivity < 2.5) {
                    feedbackClass = 'bg-yellow-100 border-yellow-400 text-yellow-700';
                    feedbackText = 'Need Improvement';
                } else {
                    feedbackClass = 'bg-green-100 border-green-400 text-green-700';
                    feedbackText = 'Excellent! Keep up the good work';
                }
                
                elements.productivityFeedback.innerHTML = `
                    <div class="${feedbackClass} px-4 py-3 rounded relative">
                        <strong>Productivity Feedback:</strong> ${feedbackText}
                    </div>
                `;
            }

            function submitDpr() {
                // Simulate saving to Google Sheets
                state.dprSubmitted = true;
                elements.successMessage.classList.remove('hidden');
                
                // Disable submit button
                elements.submitDprBtn.disabled = true;
                elements.submitDprBtn.classList.add('opacity-50');
                
                // Scroll to success message
                elements.successMessage.scrollIntoView({ behavior: 'smooth' });
                
                // In a real app, this would send data to Google Sheets
                console.log('Data to be saved:', {
                    supervisor: state.currentUser,
                    date: state.attendance.date,
                    manpower: state.attendance.manpower,
                    workEntries: state.dpr.workEntries,
                    overtime: state.overtime,
                    totalErection: state.dpr.totalErection,
                    totalDismantling: state.dpr.totalDismantling,
                    totalManhours: parseFloat(elements.totalManhours.textContent),
                    productivity: parseFloat(elements.productivity.textContent)
                });
            }

            function shareViaWhatsapp() {
                // Generate report text
                const date = new Date(state.attendance.date).toLocaleDateString();
                const supervisor = state.currentUser;
                const manpowerCount = state.attendance.manpower.length;
                const erectionVolume = state.dpr.totalErection.toFixed(2);
                const dismantlingVolume = state.dpr.totalDismantling.toFixed(2);
                const totalVolume = (state.dpr.totalErection + state.dpr.totalDismantling).toFixed(2);
                const manhours = elements.totalManhours.textContent;
                const productivity = elements.productivity.textContent;
                
                const reportText = encodeURIComponent(
                    `*Daily Progress Report - ${date}*\n\n` +
                    `*Supervisor:* ${supervisor}\n` +
                    `*Manpower:* ${manpowerCount}\n\n` +
                    `*Work Summary:*\n` +
                    `- Erection: ${erectionVolume} m³\n` +
                    `- Dismantling: ${dismantlingVolume} m³\n` +
                    `- Total Volume: ${totalVolume} m³\n\n` +
                    `*Manhours:* ${manhours} hrs\n` +
                    `*Productivity:* ${productivity} m³/hr\n\n` +
                    `*Feedback:* ${productivity < 2.5 ? 'Need Improvement' : 'Excellent! Keep up the good work'}`
                );
                
                // Open WhatsApp with pre-filled message
                window.open(`https://wa.me/?text=${reportText}`, '_blank');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9659779ba686d689',t:'MTc1MzU5MTMxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
